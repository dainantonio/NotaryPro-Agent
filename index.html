<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotaryPro AI Agent</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .typing-indicator span {
            animation: blink 1.4s infinite both;
            height: 6px; width: 6px; background-color: #3b82f6; border-radius: 50%; display: inline-block; margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes blink { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ---------------------------------------------------------
        // STATE DATABASE
        // ---------------------------------------------------------
        const STATE_DATABASE = {
            "AL": {
                "state": "Alabama (Civil Law Notaries)",
                "fees": {
                    "acknowledgment": "null",
                    "jurat": "null",
                    "oath": "null",
                    "travel": "null"
                },
                "id_requirements": {
                    "credible_witnesses": "Mentioned as a method for identity proofing for electronic and remote online notarial acts.",
                    "expired_id_rule": "null"
                },
                "biometrics": {
                    "journal_thumbprint": "null"
                },
                "certificates": {
                    "acknowledgment_text": "Each Authentic Act shall contain: The handwritten signature and original seal... (Check Handbook for full text)",
                    "jurat_text": "null"
                },
                "red_flags": [
                    "Must refrain from representing any party in any matter arising from or related to the notary's authentic act.",
                    "Cannot take official action until signature and seal are properly registered.",
                    "Prohibited from providing advice that does not treat all parties equally, accurately, fully, and impartially."
                ]
            },
            "AK": {
                "state": "Alaska",
                "fees": {
                    "acknowledgment": "null",
                    "jurat": "null",
                    "oath": "null",
                    "travel": "null"
                },
                "id_requirements": {
                    "credible_witnesses": "null",
                    "expired_id_rule": "null"
                },
                "biometrics": {
                    "journal_thumbprint": "null"
                },
                "certificates": {
                    "acknowledgment_text": "null",
                    "jurat_text": "null"
                },
                "red_flags": [
                    "Applicants may not have been convicted of a felony or incarcerated for a felony conviction within 10 years before commission.",
                    "Sureties/employers have no authority to request that regular notary commissions be revoked."
                ]
            },
            "AZ": {
                "state": "Arizona",
                "fees": {
                    "acknowledgment": "$10 per notary public signature",
                    "jurat": "$10 per notary public signature",
                    "oath": "$10 per notarial act",
                    "travel": "Mileage fees can be charged at the rate allowed for Arizona state employees."
                },
                "id_requirements": {
                    "credible_witnesses": "Two types: 1. Personal Knowledge. 2. Stranger with valid ID who knows signer.",
                    "expired_id_rule": "Generally requires unexpired ID; exceptions for real estate conveyance/financing."
                },
                "biometrics": {
                    "journal_thumbprint": "Optional; not required under law but helpful."
                },
                "certificates": {
                    "acknowledgment_text": "State of Arizona, County of... (Check Handbook for full text)",
                    "jurat_text": "State of Arizona, County of... (Check Handbook for full text)"
                },
                "red_flags": [
                    "Cannot use the term 'notario' or 'notario publico' unless an attorney.",
                    "Cannot perform act if officer or spouse is a party or has direct beneficial interest.",
                    "Cannot withhold access to original record provided by person seeking act.",
                    "Charging higher fees is a class 5 felony."
                ]
            },
            "AR": {
                "state": "Arkansas",
                "fees": {
                    "acknowledgment": "Not required to charge; if charged, must be reasonable and agreed upon.",
                    "jurat": "null",
                    "oath": "null",
                    "travel": "null"
                },
                "id_requirements": {
                    "credible_witnesses": "For RON, individual personally known to notary or identified via remote ID.",
                    "expired_id_rule": "null"
                },
                "biometrics": {
                    "journal_thumbprint": "null"
                },
                "certificates": {
                    "acknowledgment_text": "State of Arkansas, County of... (Check Handbook for full text)",
                    "jurat_text": "State of Arkansas, County of... (Check Handbook for full text)"
                },
                "red_flags": [
                    "Cannot notarize own signature.",
                    "Cannot notarize document with direct/indirect financial benefit.",
                    "Cannot perform acts for corporation if personally involved or acting as representative."
                ]
            },
            "NY": {
                "state": "New York",
                "fees": {
                    "acknowledgment": "Not specified in data (Check Handbook)",
                    "jurat": "Not specified in data",
                    "oath": "Not specified in data"
                },
                "id_requirements": {
                    "credible_witnesses": "Not specified",
                    "expired_id_rule": "Not specified"
                },
                "biometrics": {
                    "journal_thumbprint": "Not required"
                },
                "certificates": {
                    "acknowledgment_text": "Not specified",
                    "jurat_text": "Sworn to before me on this ___ day of ___..."
                },
                "red_flags": [
                    "Name must match signature exactly",
                    "Initials like 'J. Doe' prohibited if commissioned as full name",
                    "Oath of office must be signed in presence of Notary"
                ]
            },
            "OH": {
                "state": "Ohio",
                "fees": {
                    "acknowledgment": "$0.80",
                    "jurat": "Not specified (null)",
                    "oath": "$0.10",
                    "travel": "Not specified"
                },
                "id_requirements": {
                    "credible_witnesses": "Proof of identity may be satisfied by a third person known to the notary who introduces the signer to the notary.",
                    "expired_id_rule": "Not specified"
                },
                "biometrics": {
                    "journal_thumbprint": "Not required"
                },
                "certificates": {
                    "acknowledgment_text": "State of Ohio... (Check Handbook for full text)",
                    "jurat_text": "State of Ohio, County of... (Check Handbook for full text)"
                },
                "red_flags": [
                    "Never prepare instruments or give advice",
                    "Cannot notarize if you have an interest",
                    "Cannot notarize outside physical boundaries of the state",
                    "Must administer oath for affidavits",
                    "Cannot charge more than prescribed by law"
                ]
            },
            "WV": {
                "state": "West Virginia",
                "fees": {
                    "acknowledgment": "$10.00 max per signature",
                    "jurat": "$10.00 max",
                    "oath": "$10.00 max",
                    "travel": "Not specified"
                },
                "id_requirements": {
                    "credible_witnesses": "Personal knowledge OR oath of a credible witness.",
                    "expired_id_rule": "Allowed if expired less than 3 years."
                },
                "biometrics": {
                    "journal_thumbprint": "Not required"
                },
                "certificates": {
                    "acknowledgment_text": "State of West Virginia... (Check Handbook)",
                    "jurat_text": "State of West Virginia... (Check Handbook)"
                },
                "red_flags": [
                    "Do not draft legal records or practice law",
                    "Do not act as immigration consultant",
                    "Do not charge >$10.00",
                    "No direct/indirect financial interest",
                    "No immediate family notarizations if beneficial interest exists"
                ]
            }
        };

        function App() {
            const [apiKey, setApiKey] = React.useState('');
            const [hasKey, setHasKey] = React.useState(false);
            // Default to OH, but user can change
            const [selectedStateKey, setSelectedStateKey] = React.useState('OH');
            const [messages, setMessages] = React.useState([]);
            const [input, setInput] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const [mode, setMode] = React.useState('study'); 

            // Initialize message when state changes or on load
            React.useEffect(() => {
                const currentStateName = STATE_DATABASE[selectedStateKey].state;
                setMessages([
                    { role: 'assistant', content: `Welcome to the ${currentStateName} Notary Training Module. I have loaded the specific laws for ${currentStateName}. Select "Roleplay Sim" to begin a scenario.` }
                ]);
            }, [selectedStateKey]);

            const handleStart = () => {
                if(apiKey.trim().length > 0) setHasKey(true);
            };

            const sendMessage = async () => {
                if (!input.trim()) return;
                
                const newMessages = [...messages, { role: 'user', content: input }];
                setMessages(newMessages);
                setInput('');
                setLoading(true);

                // Get current state data
                const currentStateData = STATE_DATABASE[selectedStateKey];

                const SYSTEM_PROMPT = `
                    You are an expert Notary Public Instructor and Roleplay Agent for the state of ${currentStateData.state}.
                    
                    CRITICAL INSTRUCTIONS:
                    1. KNOWLEDGE BASE: You must strictly adhere to the following rules for ${currentStateData.state}:
                       - Fees: ${JSON.stringify(currentStateData.fees)}
                       - ID Rules: ${JSON.stringify(currentStateData.id_requirements)}
                       - Red Flags/Prohibitions: ${JSON.stringify(currentStateData.red_flags)}
                       - Biometrics: ${JSON.stringify(currentStateData.biometrics)}
                    
                    2. MODES:
                       - If mode is "study": Answer questions Socratically. Use the data above to correct the user if they are wrong about fees or rules.
                       - If mode is "scenario": PLAY A CHARACTER. You are a client.
                         * Create a scenario that specifically tests one of the "Red Flags" or "ID Rules" listed above.
                         * Example: If 'expired_id_rule' says 5 years, present an ID expired 6 years ago and see if they catch it.
                         * If the user makes a mistake based on the provided JSON rules, FAIL them and cite the rule.
                         * If data is "null" or "Not specified", assume standard notary best practices but warn the user to check the handbook.

                    3. GOAL: Train them to catch fraud and follow procedure.
                    4. Keep responses concise (under 100 words).
                `;

                try {
                    const contents = [
                        { role: "user", parts: [{ text: SYSTEM_PROMPT + `\n\nCurrent Mode: ${mode.toUpperCase()}\n\n` }] },
                        ...newMessages.map(m => ({
                            role: m.role === 'assistant' ? 'model' : 'user',
                            parts: [{ text: m.content }]
                        }))
                    ];

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: contents })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    const aiResponse = data.candidates[0].content.parts[0].text;
                    setMessages([...newMessages, { role: 'assistant', content: aiResponse }]);

                } catch (error) {
                    setMessages([...newMessages, { role: 'assistant', content: "Error: " + error.message + ". Please check your API Key." }]);
                } finally {
                    setLoading(false);
                }
            };

            const handleKeyDown = (e) => {
                if (e.key === 'Enter') sendMessage();
            };

            if (!hasKey) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-100 p-4">
                        <div className="bg-white p-8 rounded-xl shadow-lg max-w-md w-full">
                            <div className="text-center mb-6">
                                <i className="fas fa-stamp text-5xl text-blue-600 mb-4"></i>
                                <h1 className="text-2xl font-bold text-gray-800">NotaryPro Agent</h1>
                                <p className="text-gray-500 text-sm mt-2">Multi-State Training System</p>
                            </div>
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Select State to Train In</label>
                                    <select 
                                        value={selectedStateKey}
                                        onChange={(e) => setSelectedStateKey(e.target.value)}
                                        className="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 outline-none"
                                    >
                                        {Object.entries(STATE_DATABASE).map(([key, data]) => (
                                            <option key={key} value={key}>{data.state}</option>
                                        ))}
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">Google Gemini API Key</label>
                                    <input 
                                        type="password" 
                                        value={apiKey}
                                        onChange={(e) => setApiKey(e.target.value)}
                                        placeholder="Paste your API key here..."
                                        className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
                                    />
                                    <p className="text-xs text-gray-400 mt-2">
                                        Don't have one? <a href="https://aistudio.google.com/app/apikey" target="_blank" className="text-blue-500 hover:underline">Get a free key here</a>.
                                    </p>
                                </div>
                                <button 
                                    onClick={handleStart}
                                    className="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-200"
                                >
                                    Start Training
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col h-screen bg-white">
                    {/* Header */}
                    <div className="bg-white border-b px-6 py-4 flex justify-between items-center shadow-sm z-10">
                        <div className="flex items-center gap-3">
                            <div className="bg-blue-600 p-2 rounded-lg text-white">
                                <i className="fas fa-stamp"></i>
                            </div>
                            <div>
                                <h1 className="font-bold text-lg text-gray-800">NotaryPro Agent</h1>
                                <div className="text-xs text-gray-500 flex items-center gap-2">
                                    <span>Training:</span>
                                    <select 
                                        value={selectedStateKey}
                                        onChange={(e) => {
                                            setSelectedStateKey(e.target.value);
                                            // Reset messages when switching states mid-session
                                            setMessages([]); 
                                        }}
                                        className="bg-gray-100 border-none text-blue-600 font-bold text-xs rounded p-1 cursor-pointer focus:ring-0"
                                    >
                                        {Object.entries(STATE_DATABASE).map(([key, data]) => (
                                            <option key={key} value={key}>{data.state}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div className="flex bg-gray-100 p-1 rounded-lg">
                            <button 
                                onClick={() => setMode('study')}
                                className={`px-4 py-2 text-sm rounded-md transition-all ${mode === 'study' ? 'bg-white shadow text-blue-600 font-medium' : 'text-gray-500 hover:text-gray-700'}`}
                            >
                                Study Mode
                            </button>
                            <button 
                                onClick={() => setMode('scenario')}
                                className={`px-4 py-2 text-sm rounded-md transition-all ${mode === 'scenario' ? 'bg-white shadow text-blue-600 font-medium' : 'text-gray-500 hover:text-gray-700'}`}
                            >
                                Roleplay Sim
                            </button>
                        </div>
                    </div>

                    {/* Chat Area */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                        {messages.map((msg, index) => (
                            <div key={index} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[80%] rounded-2xl px-5 py-3 shadow-sm ${
                                    msg.role === 'user' 
                                        ? 'bg-blue-600 text-white rounded-br-none' 
                                        : 'bg-white text-gray-800 border border-gray-100 rounded-bl-none'
                                }`}>
                                    {msg.role === 'assistant' && (
                                        <div className="text-xs font-bold text-gray-400 mb-1 uppercase tracking-wider">
                                            {mode === 'scenario' ? 'Client / Trainer' : 'Instructor'}
                                        </div>
                                    )}
                                    <div className="leading-relaxed whitespace-pre-wrap">{msg.content}</div>
                                </div>
                            </div>
                        ))}
                        {loading && (
                            <div className="flex justify-start">
                                <div className="bg-white border border-gray-100 rounded-2xl rounded-bl-none px-5 py-4 shadow-sm">
                                    <div className="typing-indicator">
                                        <span></span><span></span><span></span>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Input Area */}
                    <div className="p-4 bg-white border-t">
                        <div className="max-w-4xl mx-auto relative flex items-center gap-2">
                            <input
                                type="text"
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyDown={handleKeyDown}
                                placeholder={`Ask a question about ${STATE_DATABASE[selectedStateKey].state} law...`}
                                className="flex-1 bg-gray-100 text-gray-800 p-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                            />
                            <button 
                                onClick={sendMessage}
                                disabled={loading || !input.trim()}
                                className="bg-blue-600 text-white p-4 rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md"
                            >
                                <i className="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <p className="text-center text-xs text-gray-400 mt-3">
                            AI can make mistakes. Always check your official State Notary Handbook.
                        </p>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
